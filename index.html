<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UGX Denomination Calculator</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      background: linear-gradient(to right, #e3f2fd, #ffffff);
      color: #333;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 24px;
    }

    .container {
      max-width: 100%;
      overflow-x: auto;
    }

    table {
      border: 1px solid #ccc;
      border-collapse: collapse;
      width: 100%;
      max-width: 600px;
      margin: 0 auto 20px auto;
      background-color: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    th, td {
      padding: 12px;
      text-align: right;
      border: 1px solid #ccc;
    }

    th {
      background-color: #f5f5f5;
      font-weight: 600;
    }

    tfoot th {
      background-color: #e3f2fd;
    }

    input[type="number"] {
      width: 70px;
      padding: 6px;
      font-size: 14px;
      text-align: right;
    }

    .btn {
      display: block;
      width: 90%;
      max-width: 300px;
      margin: 10px auto;
      padding: 12px;
      font-size: 16px;
      color: #fff;
      background-color: #0078D7;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .btn-danger {
      background-color: #e53935;
    }

    #remarkInput {
      display: block;
      width: 100%;
      max-width: 600px;
      margin: 0 auto 15px auto;
      padding: 10px;
      font-size: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    #captureArea {
      position: relative;
      padding-bottom: 140px;
    }

.stamp {
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 140px;
  height: auto;
  border: 2px solid #333;
  border-radius: 0; /* âœ… Make sure this is 0 */
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  font-size: 14px;
  background: #fff;
  box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
  padding: 10px;
}

    .stamp-date {
  font-size: 12px;
  margin-bottom: 4px;
  writing-mode: horizontal-tb; /* or just remove this line */
  transform: none;
}

    @media (max-width: 768px) {
      .stamp {
        position: static;
        margin: 20px auto;
      }

      input[type="number"] {
        width: 60px;
      }
    }
  </style>
</head>
<body>

  <h2>UGX Denomination Calculator</h2>

  <div class="container">
    <input type="text" id="remarkInput" placeholder="Enter your remark here...">

    <div id="captureArea">
      <table>
        <thead>
          <tr>
            <th>Note</th>
            <th>Quantity</th>
            <th>Amount</th>
          </tr>
        </thead>
        <tbody id="denominations"></tbody>
        <tfoot>
          <tr>
            <th colspan="2">Total</th>
            <th id="totalAmount">UGX 0</th>
          </tr>
        </tfoot>
      </table>

      <div class="stamp">
        <div class="stamp-date" id="stampDate">Date</div>
        <div id="stampTime">Time</div>
      </div>
    </div>
  </div>

  <button class="btn" onclick="exportAll()">Export to Excel & Snapshot</button>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    const notes = [50000, 20000, 10000, 5000, 2000, 1000, 500, 200, 100];
    const tbody = document.getElementById("denominations");

    notes.forEach(note => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>UGX ${note.toLocaleString()}</td>
        <td><input type="number" min="0" placeholder="" onchange="calculateTotal()" data-note="${note}"></td>
        <td class="amount">UGX 0</td>
      `;
      tbody.appendChild(row);
    });

    function calculateTotal() {
      let total = 0;
      tbody.querySelectorAll("tr").forEach(row => {
        const input = row.querySelector("input");
        const note = parseInt(input.getAttribute("data-note"));
        const quantity = parseInt(input.value) || 0;
        const amount = note * quantity;
        row.querySelector(".amount").textContent = `UGX ${amount.toLocaleString()}`;
        total += amount;
      });
      document.getElementById("totalAmount").textContent = `UGX ${total.toLocaleString()}`;
    }

    function updateStamp() {
      const now = new Date();
      document.getElementById("stampDate").textContent = now.toLocaleDateString();
      document.getElementById("stampTime").textContent = now.toLocaleTimeString();
    }

    function exportAll() {
      updateStamp();

      const remark = document.getElementById("remarkInput").value.trim();
      const date = new Date();
      const serial = Date.now();
      const timestamp = date.toLocaleString();
      const dateFileSafe = date.toISOString().slice(0, 10);

      const rows = [['Note', 'Quantity', 'Amount']];
      let total = 0;

      tbody.querySelectorAll("tr").forEach(row => {
        const input = row.querySelector("input");
        const note = parseInt(input.getAttribute("data-note"));
        const quantity = parseInt(input.value) || 0;
        const amount = note * quantity;
        if (quantity > 0) {
          rows.push([note, quantity, amount]);
          total += amount;
        }
      });

      rows.push(['', 'Total', total]);
      rows.push(['Generated on', timestamp, remark]);

      const csvContent = rows.map(e => e.join(",")).join("\n");
      const csvBlob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const csvUrl = URL.createObjectURL(csvBlob);
      const csvLink = document.createElement("a");
      csvLink.href = csvUrl;
      csvLink.download = `UGX_Report_${dateFileSafe}_${serial}.csv`;
      csvLink.click();

      html2canvas(document.getElementById("captureArea")).then(canvas => {
        const imgLink = document.createElement("a");
        imgLink.download = `UGX_Snapshot_${dateFileSafe}_${serial}.png`;
        imgLink.href = canvas.toDataURL("image/png");
        imgLink.click();
      });
    }

    // Initialize
    calculateTotal();
    updateStamp();
    setInterval(updateStamp, 60000);
  </script>

</body>
</html>
